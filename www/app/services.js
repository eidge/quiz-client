'use strict';

(function () {
  'use strict';

  angular.module('starter.services', ['LocalStorageModule']).run(function (Auth, $http) {
    $http.defaults.headers.common['Authorization'] = 'Basic ' + Auth.accessToken();
  }).factory('$stream', function (socketFactory) {
    var mySocket = io.connect('http://localhost:3000');

    return socketFactory({
      ioSocket: mySocket
    });
  }).service('Auth', function ($http, localStorageService) {
    return {
      register: register,
      login: login,
      logout: logout,
      accessToken: accessToken
    };

    function accessToken() {
      var username = localStorageService.get('username');
      var password = localStorageService.get('password');

      console.log(username, password);

      return btoa(username + ':' + password);
    }

    function login(username, password) {
      var params = {
        username: username,
        password: password
      };

      return $http.post('http://localhost:3000/me', params).then(saveAuthentication.bind(this, username, password));
    }

    function register(username, password) {
      var params = {
        username: username,
        password: password
      };

      return $http.post('http://localhost:3000/register', params).then(saveAuthentication.bind(this, username, password));
    }

    function logout() {
      saveAuthentication(undefined, undefined);
    }

    function saveAuthentication(username, password) {
      localStorageService.set('username', username);
      localStorageService.set('password', password);
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxZQUFXO0FBQ1YsY0FBWSxDQUFDOztBQUViLFNBQU8sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBRXZELEdBQUcsQ0FBQyxVQUFTLElBQUksRUFBRSxLQUFLLEVBQUU7QUFDekIsU0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQ25CLE1BQU0sQ0FBQyxlQUFlLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0dBQzVELENBQUMsQ0FFRCxPQUFPLENBQUMsU0FBUyxFQUFFLFVBQVMsYUFBYSxFQUFFO0FBQzFDLFFBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQzs7QUFFbkQsV0FBTyxhQUFhLENBQUM7QUFDbkIsY0FBUSxFQUFFLFFBQVE7S0FDbkIsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUVELE9BQU8sQ0FBQyxNQUFNLEVBQUUsVUFBUyxLQUFLLEVBQUUsbUJBQW1CLEVBQUU7QUFDcEQsV0FBTztBQUNMLGNBQVEsRUFBRSxRQUFRO0FBQ2xCLFdBQUssRUFBRSxLQUFLO0FBQ1osWUFBTSxFQUFFLE1BQU07QUFDZCxpQkFBVyxFQUFFLFdBQVc7S0FDekIsQ0FBQzs7QUFFRixhQUFTLFdBQVcsR0FBRztBQUNyQixVQUFJLFFBQVEsR0FBRyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDbkQsVUFBSSxRQUFRLEdBQUcsbUJBQW1CLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDOztBQUVuRCxhQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQzs7QUFFaEMsYUFBTyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsR0FBRyxRQUFRLENBQUMsQ0FBQztLQUN4Qzs7QUFFRCxhQUFTLEtBQUssQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFO0FBQ2pDLFVBQUksTUFBTSxHQUFHO0FBQ1gsZ0JBQVEsRUFBRSxRQUFRO0FBQ2xCLGdCQUFRLEVBQUUsUUFBUTtPQUNuQixDQUFDOztBQUVGLGFBQU8sS0FBSyxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSxNQUFNLENBQUMsQ0FDbEQsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7S0FDNUQ7O0FBRUQsYUFBUyxRQUFRLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRTtBQUNwQyxVQUFJLE1BQU0sR0FBRztBQUNYLGdCQUFRLEVBQUUsUUFBUTtBQUNsQixnQkFBUSxFQUFFLFFBQVE7T0FDbkIsQ0FBQzs7QUFFRixhQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLEVBQUUsTUFBTSxDQUFDLENBQ3hELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO0tBQzVEOztBQUVELGFBQVMsTUFBTSxHQUFHO0FBQ2hCLHdCQUFrQixDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztLQUMxQzs7QUFFRCxhQUFTLGtCQUFrQixDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUU7QUFDOUMseUJBQW1CLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUM5Qyx5QkFBbUIsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0tBQy9DO0dBQ0YsQ0FBQyxDQUFDO0NBQ04sQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoic2VydmljZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnc3RhcnRlci5zZXJ2aWNlcycsIFsnTG9jYWxTdG9yYWdlTW9kdWxlJ10pXG5cbiAgICAucnVuKGZ1bmN0aW9uKEF1dGgsICRodHRwKSB7XG4gICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzXG4gICAgICAgIC5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9ICdCYXNpYyAnICsgQXV0aC5hY2Nlc3NUb2tlbigpO1xuICAgIH0pXG5cbiAgICAuZmFjdG9yeSgnJHN0cmVhbScsIGZ1bmN0aW9uKHNvY2tldEZhY3RvcnkpIHtcbiAgICAgIHZhciBteVNvY2tldCA9IGlvLmNvbm5lY3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcpO1xuXG4gICAgICByZXR1cm4gc29ja2V0RmFjdG9yeSh7XG4gICAgICAgIGlvU29ja2V0OiBteVNvY2tldFxuICAgICAgfSk7XG4gICAgfSlcblxuICAgIC5zZXJ2aWNlKCdBdXRoJywgZnVuY3Rpb24oJGh0dHAsIGxvY2FsU3RvcmFnZVNlcnZpY2UpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlZ2lzdGVyOiByZWdpc3RlcixcbiAgICAgICAgbG9naW46IGxvZ2luLFxuICAgICAgICBsb2dvdXQ6IGxvZ291dCxcbiAgICAgICAgYWNjZXNzVG9rZW46IGFjY2Vzc1Rva2VuXG4gICAgICB9O1xuXG4gICAgICBmdW5jdGlvbiBhY2Nlc3NUb2tlbigpIHtcbiAgICAgICAgdmFyIHVzZXJuYW1lID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ3VzZXJuYW1lJyk7XG4gICAgICAgIHZhciBwYXNzd29yZCA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdwYXNzd29yZCcpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKHVzZXJuYW1lLCBwYXNzd29yZCk7XG5cbiAgICAgICAgcmV0dXJuIGJ0b2EodXNlcm5hbWUgKyAnOicgKyBwYXNzd29yZCk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL21lJywgcGFyYW1zKVxuICAgICAgICAgIC50aGVuKHNhdmVBdXRoZW50aWNhdGlvbi5iaW5kKHRoaXMsIHVzZXJuYW1lLCBwYXNzd29yZCkpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiByZWdpc3Rlcih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9yZWdpc3RlcicsIHBhcmFtcylcbiAgICAgICAgICAudGhlbihzYXZlQXV0aGVudGljYXRpb24uYmluZCh0aGlzLCB1c2VybmFtZSwgcGFzc3dvcmQpKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgICAgICBzYXZlQXV0aGVudGljYXRpb24odW5kZWZpbmVkLCB1bmRlZmluZWQpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzYXZlQXV0aGVudGljYXRpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCd1c2VybmFtZScsIHVzZXJuYW1lKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ3Bhc3N3b3JkJywgcGFzc3dvcmQpO1xuICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==